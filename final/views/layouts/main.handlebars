<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="/public/css/site.css">
    <!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous"> -->
    <link rel="stylesheet" type="text/css" href="/public/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="../../public/css/jssocials.css" />
    <link rel="stylesheet" type="text/css" href="../../public/css/jssocials-theme-minima.css" />
    <title>{{title}}</title>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://rawgit.com/leizongmin/js-xss/master/dist/xss.js"></script>
    <script src="https://cdn.rawgit.com/PascaleBeier/bootstrap-validate/v2.2.0/dist/bootstrap-validate.js" ></script>
    <script src="../../public/js/jssocials.js"></script>
    <script src="../../public/js/hiddenform.js"></script>
    <!--<script src="/public/js/tota11y.min.js"></script>-->
    <h1></h1>
    <h2></h2>
    <h3></h3>
    <div id="navBar" class="container">
        <nav class="navbar sticky-top navbar-expand-lg navbar-light" style="background-color: #f5f5f5;">
            <span class="navbar-brand mb-0 h1">
                <a class="navbar-brand" href="/">
                    <img src="/public/image/Guitablogo.jpg" width="150" height="60" alt="GuiTabsLogo">
                </a>
            </span>
            <div class="row d-lg-none">
                <a id="addNewNavBtn" class="nav-link my-2 my-sm-0" role="button" href="#" data-toggle="collapse" data-target="#addNewTabNav" aria-controls="addNewTabNav" aria-expanded="false" aria-label="Add New Tab">
                    <span class="fa fa-plus" data-toggle="tooltip" title="Add New Tab"></span>
                </a>
                <a id="searchNavBtn" class="nav-link my-2 my-sm-0" role="button" href="#" data-toggle="collapse" data-target="#searchNav" aria-controls="searchNav" aria-expanded="false" aria-label="Search Tab">
                    <span class="fa fa-search" data-toggle="tooltip" title="Search Tabs"></span>
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon" data-toggle="tooltip" title="Menu"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse justify-content-start" id="navbarNav">
                <ul class="navbar-nav">
                    {{#each status}}
                    <li class="nav-item">
                        {{{content}}}
                    </li>
                    {{/each}}
                </ul>
            </div>
            <div class="collapse navbar-collapse justify-content-end" id="addNewTabNav">
                <form class="form-inline" method="GET" action="/tabs/newtabs">
                    <button class="btn btn-outline-success my-2 my-sm-0 btn-lg" type="submit" id="newTabBtn">New Tab</button>
                </form>
            </div>
            <script language="javascript" type="text/javascript">
                $(document).ready(function () {
                    if(document.getElementById("uNameShow") == null) {
                        document.getElementById("newTabBtn").style.display = "none";
                        document.getElementById("addNewNavBtn").style.display = "none";
                    }
                })
            </script>
            <div class="collapse navbar-collapse justify-content-end" id="searchNav">
                <form class="form-inline" method="POST" action="/tabs/search" id="search">
                    <div class="input-group">
                        <label for="searchText" class="sr-only">Search:</label>
                        <input id="searchText" type="text" class="form-control" placeholder="Search The Name Of Tabs" name="name" required>
                        <div class="input-group-append">
                        <button type="submit" class="btn btn-primary">
                            <span class="fa fa-search"></span>
                        </button>
                        </div>
                    </div>
                </form>
            </div>
        </nav>
    </div>
    <main>
        {{{body}}}
    </main>
    <div class="modal fade" id="signin" tabindex="-1" role="dialog" aria-labelledby="signinTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signinTitle">Sign In</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="signinForm">
                    <div class="modal-body" id="signinBody">
                        <div class="container" id="signinError">
                        </div>
                        <div class="form-group">
                            <label for="signinUser" class="sr-only">Username:</label>
                            <input id="signinUser" type="text" name="user" class="form-control" placeholder="Username" required>
                        </div>
                        <div class="form-group">
                            <label for="signinPassword" class="sr-only">Password:</label>
                            <input id="signinPassword" class="form-control" type="password" name="password" placeholder="Password" required>
                        </div>
                        <div class="custom-control custom-checkbox">
                            <input type="checkbox" class="custom-control-input" id="rememberme" name="rememberme" value="" >
                            <label class="custom-control-label" for="rememberme">Remember me</label>
                            <small class="text-muted">We don't save your password on cookie, and this just keep your login status in 7 days</small>
                        </div>
                    </div>
                    <div class="modal-footer" id="signinFooter">
                        <button type="submit" id="signInSubmit" class="btn btn-primary">Submit</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <script>
                            $("#signinForm").submit(function(event) {
                                event.preventDefault();
                                $("#signInSubmit").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...');
                                $('#signInSubmit').prop('disabled', true);

                                $.ajax({
                                    type: "post",
                                    url: "/signin",
                                    dataType: "json",
                                    data: {
                                        user: $("#signinUser").val(),
                                        password: $("#signinPassword").val(),
                                        rememberme: $("#rememberme").val()
                                    },
                                    success: function(res) {
                                        if(res["status"] == "success") {
                                            $("#signinFooter").hide();
                                            $("#signinBody").html('<div class="container"><p>' + res["user"] + ', welcome back!</p></br><span id="totalSecond">5</span><span id="second"> Seconds</span><span id="nextcontent"> later to go back homepage!</span></div>');
                                            jQuery.getScript("/public/js/autourl.js").done(function(){
                                                var fun = auto;
                                                fun("/");
                                            })
                                        }
                                        else
                                        if(res["status"] == "notmatched") {
                                            $("#signinError").html('<p>Username or password error!</p>');
                                            $("#signinError").css('color', 'red');
                                            $("#signInSubmit").html('Submit');
                                            $('#signInSubmit').prop('disabled', false);
                                        }
                                    },
                                    error: function(err) {
                                        location.href = "/error";
                                    }
                                });
                            })
                        </script>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="signup" tabindex="-1" role="dialog" aria-labelledby="signupTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="signupTitle">Sign Up</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form id="signupForm">
                    <div class="modal-body" id="signupBody">
                        <div class="container" id="signupError">
                        </div>
                        <div class="form-group">
                            <label for="user" class="sr-only">User Name:</label>
                            <input id="user" type="text" name="user" class="form-control" placeholder="Username" />
                        </div>
                        <div class="form-group">
                            <label for="password" class="sr-only">Password:</label>
                            <input id="password" type="password" name="password" class="form-control" placeholder="Password"/>
                        </div>
                        <div class="form-group">
                            <label for="conPassword" class="sr-only">Confirm Password:</label>
                            <input id="conPassword" type="password" name="conPassword" class="form-control" placeholder="Confirm"/>
                        </div>
                        <div class="form-group">
                            <label for="first" class="sr-only">First Name:</label>
                            <input id="first" type="text" name="firstName" class="form-control" placeholder="First Name"/>
                        </div>
                        <div class="form-group">
                            <label for="last" class="sr-only">Last Name:</label>
                            <input id="last" type="text" name="lastName" class="form-control" placeholder="Last Name"/>
                        </div>
                        <div class="form-group">
                            <label for="email" class="sr-only">Email:</label>
                            <input id="email" type="email" name="email" class="form-control" placeholder="Email"/>
                        </div>
                    </div>
                    <div class="modal-footer" id="signupFooter">
                        <button type="submit" id="signUpSubmit" class="btn btn-primary" disabled="true">Submit</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <script>
                            var empty = false;
                            var emailValid = false;
                            var userMin = false;
                            var userMax = false;
                            var passwordMin = false;
                            var passwordMax = false;
                            var conpassMatch = false;
                                bootstrapValidate(['#user', '#password', '#conPassword', '#first', '#last', '#email'], 'required: This can not be empty!', function(isEmpty) { 
                                    if(isEmpty) {
                                        empty = true; 
                                        if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                            $("#signUpSubmit").attr('disabled', false);
                                        else
                                            $("#signUpSubmit").attr('disabled', true);
                                    } 
                                    else {
                                        empty = false;
                                        $("#signUpSubmit").attr('disabled', true);
                                    }
                                });
                                bootstrapValidate('#email', 'email: Enter a valid E-Mail!', function(isEmail) { if(isEmail) {emailValid = true; if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                    $("#signUpSubmit").attr('disabled', false); else
                                    $("#signUpSubmit").attr('disabled', true); } else {emailValid = false; $("#signUpSubmit").attr('disabled', true);}});
                                bootstrapValidate('#user', 'min:6: Your username should more than 6 charactors!', function(isUser) { 
                                    if(isUser) {
                                        userMin = true; 
                                        if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                            $("#signUpSubmit").attr('disabled', false); 
                                        else
                                            $("#signUpSubmit").attr('disabled', true);
                                    } 
                                    else {
                                        userMin = false; 
                                        $("#signUpSubmit").attr('disabled', true);
                                    }
                                });
                                bootstrapValidate('#user', 'max:20: Your username should no more than 20 charactors!', function(isUser) { 
                                    if(isUser) {
                                        userMax = true; 
                                        if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                            $("#signUpSubmit").attr('disabled', false); 
                                        else
                                            $("#signUpSubmit").attr('disabled', true);
                                    } 
                                    else {
                                        userMax = false; 
                                        $("#signUpSubmit").attr('disabled', true);
                                    }
                                });
                                bootstrapValidate('#conPassword', 'matches: #password: The password is not match!', function(isMatched) { if(isMatched) {conpassMatch = true; if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                    $("#signUpSubmit").attr('disabled', false); else
                                    $("#signUpSubmit").attr('disabled', true);} else {conpassMatch = false; $("#signUpSubmit").attr('disabled', true);}});
                                bootstrapValidate('#password', 'min:6: Your password should more than 6 charactors!', function(isPassword) { if(isPassword) {passwordMin = true; if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                    $("#signUpSubmit").attr('disabled', false); else
                                    $("#signUpSubmit").attr('disabled', true);} else {passwordMin = false; $("#signUpSubmit").attr('disabled', true);}});
                                bootstrapValidate('#password', 'max:20: Your password should no more than 20 charactors!', function(isPassword) { if(isPassword) {passwordMax = true; if(empty && emailValid && userMin && userMax && passwordMin && passwordMax && conpassMatch)
                                    $("#signUpSubmit").attr('disabled', false); else
                                    $("#signUpSubmit").attr('disabled', true);} else {passwordMax = false; $("#signUpSubmit").attr('disabled', true);}});
                            $("#signupForm").submit(function(event) {
                                event.preventDefault();
                                $("#signUpSubmit").html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...');
                                $('#signUpSubmit').prop('disabled', true);

                                $.ajax({
                                    type: "post",
                                    url: "/signup",
                                    dataType: "json",
                                    data: {
                                        user: $("#user").val(),
                                        password: $("#password").val(),
                                        conPassword: $("#conPassword").val(), 
                                        firstName: $("#first").val(),
                                        lastName: $("#last").val(),
                                        email: $("#email").val()
                                    },
                                    success: function(res) {
                                        if(res["status"] == "success") {
                                            $("#signupFooter").hide();
                                            $("#signupBody").html('<div class="container"><p>' + res["user"] + ', welcome to Guitab as a member!</p></br><span id="totalSecond">5</span><span id="second"> Seconds</span><span id="nextcontent"> later to go back homepage!</span></div>');
                                            jQuery.getScript("/public/js/autourl.js").done(function(){
                                                var fun = auto;
                                                fun("/");
                                            })
                                        }
                                        else
                                        if(res["status"] == "notmatched") {
                                            $("#signupError").html('<p>Username exists!</p>');
                                            $("#signupError").css('color', 'red');
                                            $("#signUpSubmit").html('Submit');
                                            $('#signUpSubmit').prop('disabled', true);
                                        }
                                        else 
                                        if(res["status"] == "passworderror") {
                                            $("#signupError").html('<p>Please Confirm your password!</p>');
                                            $("#signupError").css('color', 'red');
                                            $("#signUpSubmit").html('Submit');
                                            $('#signUpSubmit').prop('disabled', true);
                                        }
                                    },
                                    error: function(err) {
                                        location.href = "/error";
                                    }
                                });
                            })
                        </script>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div class="modal fade" id="logoutDia" tabindex="-1" role="dialog" aria-labelledby="logoutTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header" id="logoutHeader">
                    <h5 class="modal-title" id="logoutTitle">Log Out</h5>
                </div>
                <div class="modal-body" id="logoutBody">
                    Do you want to log out?
                </div>
                <div class="modal-footer" id="logoutFooter">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary" id="logoutSubmit">Yes</button>
                    <script>
                        $("#logoutSubmit").click(function(){
                            $.ajax({
                                dataType: "json",
                                type: "get",
                                url: "/logout",
                                success: function() {
                                    $("#logoutFooter").hide();
                                    $("#logoutBody").html('<div class="container"><p>Log out successfully! Expecting your back!</p></br><span id="totalSecond">5</span><span id="second"> Seconds</span><span id="nextcontent"> later to go back homepage!</span></div>');
                                    jQuery.getScript("/public/js/autourl.js").done(function(){
                                        var fun = auto;
                                        fun("/");
                                    });
                                }
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
    <footer id="footer">
        <small>copyright: Group 8</br></small>
        <small>Share our site by:</small>
        <div id="share"></div>
    </footer>
    <script>
        $(document).ready(function () {
            $("#share").jsSocials({
                shareIn: "popup",
                showCount: false,
                showLabel: false,
                shares: ["email", "twitter", "facebook", "linkedin", "whatsapp"]
            });
        });
        window.onload = function() {
            $(".jssocials-share.jssocials-share-email").find('a[class=jssocials-share-link]').prop('title', 'E-mail');
            $(".jssocials-share.jssocials-share-twitter").find('a[class=jssocials-share-link]').prop('title', 'Tweet');
            $(".jssocials-share.jssocials-share-facebook").find('a[class=jssocials-share-link]').prop('title', 'Facebook Like');
            $(".jssocials-share.jssocials-share-googleplus").find('a[class=jssocials-share-link]').prop('title', 'Google+1');
            $(".jssocials-share.jssocials-share-linkedin").find('a[class=jssocials-share-link]').prop('title', 'LinkedIn');
            $(".jssocials-share.jssocials-share-whatsapp").find('a[class=jssocials-share-link]').prop('title', "What'sApp");
            $(function () {
                $('[data-toggle="tooltip"]').tooltip()
            });
        }
    </script>
</body>
</html>